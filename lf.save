有点头晕<template>
    <div :class="style.advertiserDiv"  v-loading="loading">
        <Button type="primary" class="advertisBtn" @click="returnClick">{{changeLanguge('return')}}</Button>
        <div :class="style.detailTitle"><span>{{changeLanguge('advertiserDetail')}}</span></div>
        <div :class="style.newCondition">
           <el-row v-if="dataSource"   class="adverDetail">
               <el-col :span="5" style="position:relative;">
                    <img :src="detaillogoUrl" :class="style.detailImg" v-if="hasLogo"> 
                    <div v-if="!hasLogo" :class="style.detailImg"><p>{{appName?appName.charAt(0):''}}</p></div>
                    <div :class="style.newTitle">
                       <p :class="style.detailName">{{appName}}</p>   
                    </div>               
               </el-col>
               <div style="position:absolute;top:5px;bottom:5px;width:1px;background:#CECECE;left:20.5%;"></div>
               <el-col :span="(dataSource.source_app.data&&(dataSource.source_app.data.length)>=15)?5:10">
                  <div>
                      <p :class="style.titltShowFont">{{changeLanguge('developer')}}:</p>
                      <span :class="style.contentShowFont">{{dataSource.developer}}</span>
                  </div>
                  <div>
                      <span :class="style.titltShowFont">{{changeLanguge('domain')}}:</span>
                      <span :class="style.contentShowFont">{{dataSource.platform == 1?'iOS':'Android'}}</span>
                  </div>
                  <div>
                      <span :class="style.titltShowFont">{{changeLanguge('planTypes')}}:</span>
                      <span :class="style.contentShowFont">{{typeName}}</span>
                  </div>
               </el-col>
               <div v-if="dataSource.source_app.data&&(dataSource.source_app.data.length)>=15" style="position:absolute;top:5px;bottom:5px;width:1px;background:#CECECE;left:41%;"></div>
               <div v-if="(dataSource.source_app.data&&(dataSource.source_app.data.length)<15)||!dataSource.source_app.data" style="position:absolute;top:5px;bottom:5px;width:1px;background:#CECECE;left:62%;"></div>
               <el-col :span="4">
                  <div>
                      <span :class="style.titltShowFont">{{changeLanguge('tfDays')}}:</span>
                      <span :class="style.contentShowFont">{{dataSource.days}}</span>
                  </div>
                  <div>
                      <span :class="style.titltShowFont">{{changeLanguge('adsTotal')}}:</span>
                      <span :class="style.contentShowFont">{{dataSource.uniq_count}}</span>
                  </div>
                  <div>
                      <span :class="style.titltShowFont">{{changeLanguge('impressionTotal')}}:</span>
                      <span :class="style.contentShowFont">{{dataSource.impression}}</span>
                  </div>
               </el-col>
               <div v-if="dataSource.source_app.data&&(dataSource.source_app.data.length)>=15" style="position:absolute;top:5px;bottom:5px;width:1px;background:#CECECE;left:57%;"></div>
               <div v-if="(dataSource.source_app.data&&(dataSource.source_app.data.length)<15)||!dataSource.source_app.data" style="position:absolute;top:5px;bottom:5px;width:1px;background:#CECECE;left:79%;"></div>
               <el-col :span="(dataSource.source_app.data&&(dataSource.source_app.data.length)>=15)?10:5">
                   <span :class="style.titltShowFont">{{changeLanguge('tfmedia')}}</span>
                   <div>
                       <span v-for="(item,index) in dataSource.source_app.data" :key="`${index}`">
                          <Tooltip placement="bottom" :class="style.tooltip">
                             <span slot="content">{{item.name}}</span>
                             <img  :key="`${index}`" :class="style.newDetailImg" :src="item.logo_url">
                          </Tooltip> 
                       </span> 
                   </div>
               </el-col>
           </el-row>
        </div>
        <div :class="style.tabDiv"   class="advertiseTab">
           <el-tabs type="border-card" v-model="activeName" @tab-click="tabClick">
              <el-tab-pane :label="changeLanguge('adsSC')" name="first">
                  <cy-ads></cy-ads>
              </el-tab-pane>
              <el-tab-pane :label="changeLanguge('hotText')" name="third">
                  <ads-grid :keyword="storeid" :apptype="apptype" :region="region"></ads-grid>
              </el-tab-pane>
              <el-tab-pane  name="second" :disabled="perssionData && perssionData.advertiser_limit != 1">
                  <span slot="label" v-if="perssionData && perssionData.advertiser_limit == 1">{{changeLanguge('launchInf')}}</span>                  
                  <span slot="label" v-if="perssionData && perssionData.advertiser_limit != 1">
                       <Tooltip placement="right" class="tfTool">
                           <Icon type="ios-locked"></Icon> {{changeLanguge('launchInf')}}
                           <div slot="content" :class="style.secondTip">
                              <p>{{changeLanguge('tfTip')}}<span :class="style.contctUs" @click="contactUS">{{changeLanguge('touch')}}</span></p>                            
                           </div>
                       </Tooltip>
                   </span>
                  <detail-form v-if="activeName == 'second'"></detail-form>
              </el-tab-pane>
              
              <!-- <el-tab-pane :label="`${changeLanguge('deepTrack')}`" name="fourth" v-if="this.typeName!=changeLanguge('onlineEcommerce')">
                  <deep-track :isAttention="isAttention" v-if="activeName == 'fourth'" @favorite="favorite" @unFavorite="unFavorite" :favouriteDis="dataSource && dataSource.allow_track"
                  :unFavDis="dataSource && dataSource.cancel_track" :isTrack="dataSource && dataSource.is_tracked" @touchClick="contactUS" :storeid="storeid"
                  :isCanAtten="dataSource.allow_track == 0?false:true"></deep-track>
              </el-tab-pane> -->
           </el-tabs>
       </div>
       <favorite-dialog :dialogVis="dialogVis" @close="close" @sureClick="sureClick"
       @contactUS="contactUS"></favorite-dialog>
       <contact-us :dialogVisible="contactVis" @close="touchClose" :title="touchTitle"></contact-us>
    </div>
</template>
<script>
import style from '@/css/advertiser.css'
import CyAds from './cy-ads'
import DetailForm from './detail-form'
import DeepTrack from './deep-track'
import FavoriteDialog from './favorite-dialog'
import {mapGetters,mapActions} from 'vuex'
import {perssionData} from '../main/mutation-types' 
import AdsGrid from './ads-grid'
import {attentionClick,noAttentionClick,getDetailData} from './mutation-types'
import ContactUs from '#com/contact-us'
export default {
    data(){
        return{
            style,
            hasLogo: false, //是否有logo
            detaillogoUrl: '', //logo的链接地址
            appName: '', //app名称
            region: '', //渠道
            dataSource: null,
            typeName: '', //行业类型
            activeName: 'first',
            dialogVis: false, //关注弹框
            isVip: false, //当前是不是vip用户
            forthDis: false, //第四个是否可点
            tableData: [], //表格数据源
            isAttention: false, //是否关注
            storeid: '', //当前追踪和取消追踪的storeid
            contactVis: false, //联系我们弹框是否可见
            touchTitle: this.changeLanguge('touch'),
            loading: false,
            apptype: '1', //app的type
        }
    },
    components:{
        CyAds,
        DetailForm,
        DeepTrack,
        FavoriteDialog,
        AdsGrid,
        ContactUs,
    },
    methods:{
        ...mapActions({
            attentionClick,
            noAttentionClick,
            getDetailData,
        }),
        //处理路由跳转
        dealRoute(){
           let query = this.$route.query;
           if(query){
               if(query.store)
                  this.storeid = query.store;               
               if(query.region)
                   this.region = query.region.toString();
               if(query.type){
                   this.apptype = query.type;
                   this.typeName = query.type == '1'?this.changeLanguge('game'):(query.type == '2'?this.changeLanguge('tool'):this.changeLanguge('onlineEcommerce')); 
               }                 
               if(query.current)
                  this.activeName = query.current;          
           }
           //获取详细数据
           this.getData();        
       },
       //点击追踪
       favorite(){
              this.dialogVis = true;
       },
       //点击取消追踪
       async unFavorite(){
          let result = await this.noAttentionClick({
              storeid: this.storeid
          });
          if(!result) return;
          this.$Notice.config({
               top: 90
          });
          let data = JSON.parse(data);
          if(data.status == 200){
              this.dataSource.is_tracked = 0;
          }else if(data.status == 201){
                this.$Notice.warning({
                    title: this.changeLanguge('favouriteTip'),
                });
          }else{
                this.$Notice.warning({
                    title: this.changeLanguge('errorTip'),
                });
          }
       },
       //关闭广告主提示的弹框
       close(){
           this.dialogVis = false;
       },
       tabClick(){
       },
       //确定关注
       async sureClick(){
           let result = await this.attentionClick({
               storeid: this.storeid,
               region: this.$route.query.region
           });
           if(!result) return;
           let data = JSON.parse(result);
           this.$Notice.config({
                top: 90
            });
           if(data.status == 200){
               this.isAttention = true;
               this.dataSource.is_tracked = 1;              
           }else if(data.status == 201){
               this.isAttention = false;
               this.$Notice.warning({
                    title: this.changeLanguge('moreLimit'),
                });
           }else{
               this.isAttention = false;
               this.$Notice.warning({
                    title: this.changeLanguge('errorTip'),
               });
           }
           this.dialogVis = false;
       },
       //联系我们
       contactUS(){
           this.dialogVis = false;
           this.contactVis = true;
       },
       //返回
       returnClick(){
           this.$router.go(-1);
       },
       //联系我们弹框关闭
       touchClose(){
           this.contactVis = false;
       },
       //获取数据
       async getData(){
          this.loading = true;
          let result = await this.getDetailData({
              storeid: this.storeid,
              type: this.$route.query.type
          });
          
          if(!result) return;
          let data = JSON.parse(result);
          if(data){
              this.dataSource = data.data[0];
              if(this.$route.query.type == '1' || this.$route.query.type == '2'){
                    this.appName = this.dataSource.name;
                    this.detaillogoUrl = this.dataSource.logoUrl;
              }else{
                    this.appName = this.dataSource.domain;
              }
              this.hasLogo = this.dataSource.hasLogo;
              this.isAttention = this.dataSource.is_tracked ==1?true:false;
          }
          this.loading = false;
       }
    },
    created(){
        this.dealRoute();      
    },
    watch:{
        $route(){
            this.dealRoute();
        },
    },
    computed:{
        ...mapGetters({
            perssionData,
        }),
    }
}
</script>



:set nu
FHJFJ
